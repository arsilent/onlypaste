<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Kalıcı Video Upload</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{--bg:#0d1117;--bg2:#161b22;--accent:#0a84ff;--text:#c9d1d9;--danger:#f85149}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,Arial;background:var(--bg);color:var(--text);padding:1rem}
    h1{margin-top:0;color:var(--accent)}
    input[type=file]{margin-bottom:1rem}
    .section{margin-bottom:2rem}
    .video-item{background:var(--bg2);padding:.75rem;margin-bottom:.75rem;border-radius:6px;display:flex;align-items:center;gap:.75rem;flex-wrap:wrap}
    .video-item video{max-width:100%;height:auto;border-radius:4px;max-height:150px}
    .video-item .info{flex:1;min-width:200px}
    .video-item .info p{margin:.2rem 0;font-size:.85rem}
    .video-item button{background:var(--danger);border:none;color:#fff;padding:.4rem .7rem;border-radius:4px;cursor:pointer;font-size:.8rem}
    .video-item button:hover{filter:brightness(1.2)}
    #loader{display:none;margin-bottom:1rem;color:var(--accent)}
  </style>
</head>
<body>
  <h1>Kalıcı Video Upload</h1>

  <input id="fileInput" type="file" accept="video/*" multiple>
  <div id="loader">Yükleniyor…</div>

  <div class="section">
    <h2>Benim Yüklediklerim</h2>
    <div id="myVideos"></div>
  </div>

  <script>
    const API_URL = 'https://tmpfiles.org/api/v1/upload';
    const input     = document.getElementById('fileInput');
    const myVideos  = document.getElementById('myVideos');
    const loader    = document.getElementById('loader');

    // Sayfa açılınca listele
    window.addEventListener('DOMContentLoaded', listMy);

    // Dosya ekleme
    input.addEventListener('change', async () => {
      loader.style.display = 'block';
      for (const file of [...input.files]) {
        await upload(file);
      }
      input.value = '';
      loader.style.display = 'none';
    });

    async function upload(file) {
      const form = new FormData();
      form.append('file', file);
      try {
        const res = await fetch(API_URL, { method: 'POST', body: form });
        const json = await res.json();
        if (json.status === 'success') {
          const url = json.data.url.replace('tmpfiles.org/', 'tmpfiles.org/dl/'); // direct link
          saveVideo(url, file.name);
        } else {
          alert('Yüklenemedi: ' + JSON.stringify(json));
        }
      } catch (e) {
        alert('Bağlantı hatası: ' + e);
      }
    }

    function saveVideo(url, filename) {
      const key = 'my_' + Date.now() + '_' + filename;
      localStorage.setItem(key, url);
      listMy();
    }

    function listMy() {
      myVideos.innerHTML = '';
      Object.keys(localStorage)
        .filter(k => k.startsWith('my_'))
        .sort()
        .reverse()
        .forEach(k => addCard(k, localStorage.getItem(k)));
    }

    function addCard(key, url) {
      const wrapper = document.createElement('div');
      wrapper.className = 'video-item';

      const vid = document.createElement('video');
      vid.src   = url;
      vid.controls = true;

      const info = document.createElement('div');
      info.className = 'info';
      const name = key.replace('my_', '').split('_').slice(1).join('_');
      info.innerHTML = `<p>${name}</p><small>${url}</small>`;

      const delBtn = document.createElement('button');
      delBtn.textContent = 'Sil';
      delBtn.onclick = () => { localStorage.removeItem(key); listMy(); };

      wrapper.appendChild(vid);
      wrapper.appendChild(info);
      wrapper.appendChild(delBtn);
      myVideos.appendChild(wrapper);
    }
  </script>
</body>
</html>
